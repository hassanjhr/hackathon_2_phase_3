# Implementation Plan: Todo Full-Stack Web Application

**Branch**: `001-todo-fullstack-app` | **Date**: 2026-02-06 | **Spec**: [spec.md](./spec.md)
**Input**: Feature specification from `/specs/001-todo-fullstack-app/spec.md`

**Note**: This plan follows the Spec-Kit Plus workflow and constitutional principles.

## Summary

Build a secure, multi-user Todo web application with JWT-based authentication, RESTful API, and responsive frontend. Users can register, sign in, and manage their personal tasks (create, view, update, delete, toggle completion). All user data is isolated at the database level. The application uses Better Auth for authentication, FastAPI for the backend API, SQLModel for ORM, Neon Serverless PostgreSQL for data persistence, and Next.js 16+ App Router for the frontend. All implementation will be generated by Claude Code specialized agents following the automation-first principle.

## Technical Context

**Language/Version**:
- Frontend: TypeScript with Next.js 16+
- Backend: Python 3.11+

**Primary Dependencies**:
- Frontend: Next.js 16+ (App Router), Better Auth, React, TailwindCSS
- Backend: FastAPI, SQLModel, PyJWT, python-jose, passlib, uvicorn
- Database: Neon Serverless PostgreSQL (psycopg2 or asyncpg driver)

**Storage**: Neon Serverless PostgreSQL (cloud-hosted, production-grade)

**Testing**:
- Backend: pytest (API endpoint testing, JWT verification testing)
- Frontend: Manual testing (authentication flow, CRUD operations, responsive design)

**Target Platform**:
- Frontend: Web browsers (desktop and mobile, minimum 320px width)
- Backend: Linux server (containerizable, cloud-deployable)

**Project Type**: Web application (separate frontend and backend services)

**Performance Goals**:
- API response time: <3 seconds for task operations
- Authentication flow: <10 seconds from signin to dashboard
- Task creation: <3 seconds from submit to display
- Frontend perceived latency: <1 second for UI interactions

**Constraints**:
- No manual coding (all code generated by Claude Code agents)
- JWT token expiration: 24 hours (configurable)
- Task title max length: 200 characters
- Task description max length: 2000 characters
- Password minimum length: 8 characters
- Frontend and backend must be separate services with CORS configured

**Scale/Scope**:
- Target: Small to medium user base (hundreds of users)
- Expected task volume: ~100 tasks per user
- No pagination required in basic implementation
- Single-region deployment

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

**I. Spec-First Development**
- [x] Feature has complete spec.md with acceptance criteria, API contracts, and data models
- [x] No implementation has begun before spec approval

**II. Security by Default**
- [x] All API endpoints will require JWT authentication
- [x] JWT verification strategy documented (middleware validates signature and expiration)
- [x] User identity extraction from JWT (not request body) confirmed
- [x] User data isolation strategy defined (database queries filtered by authenticated user_id)

**III. User Data Isolation**
- [x] Database models include user_id foreign keys where applicable (Task model has user_id FK)
- [x] Query filtering by authenticated user_id documented (all task queries filter by user_id)
- [x] No cross-user data access paths identified (403 Forbidden for unauthorized access attempts)

**IV. Reproducibility**
- [x] Plan references spec.md and will generate tasks.md
- [x] Significant architectural decisions identified for ADR documentation (JWT flow, database schema, API design)
- [x] Implementation will be traceable through PHRs

**V. Automation-First**
- [x] Appropriate Claude Code agents identified for each domain:
  - `auth-security-handler` for authentication features (Better Auth + JWT)
  - `nextjs-ui-builder` for frontend features (UI components, pages, routing)
  - `neon-db-manager` for database design (schema, models, migrations)
  - `fastapi-backend-dev` for backend API (endpoints, middleware, validation)
- [x] No manual coding planned

**VI. Production Realism**
- [x] Using Neon PostgreSQL (not in-memory/SQLite)
- [x] Using Better Auth with JWT (not hardcoded users)
- [x] Using FastAPI with REST conventions (not mock endpoints)
- [x] Using Next.js 16+ App Router (not static HTML)
- [x] Proper error handling with HTTP status codes planned (401, 403, 404, 422, 500)
- [x] Environment-based configuration (.env) planned (JWT secret, database URL)

**Constitution Check Status**: ✅ PASSED - All gates satisfied

## Project Structure

### Documentation (this feature)

```text
specs/001-todo-fullstack-app/
├── spec.md              # Feature specification (completed)
├── plan.md              # This file (in progress)
├── research.md          # Phase 0 output (to be generated)
├── data-model.md        # Phase 1 output (to be generated)
├── quickstart.md        # Phase 1 output (to be generated)
├── contracts/           # Phase 1 output (to be generated)
│   ├── auth-api.yaml    # Authentication endpoints
│   └── tasks-api.yaml   # Task CRUD endpoints
├── checklists/
│   └── requirements.md  # Spec quality checklist (completed)
└── tasks.md             # Phase 2 output (/sp.tasks command - NOT created by /sp.plan)
```

### Source Code (repository root)

```text
backend/
├── src/
│   ├── main.py                 # FastAPI application entry point
│   ├── config.py               # Environment configuration
│   ├── database.py             # Database connection and session management
│   ├── models/
│   │   ├── __init__.py
│   │   ├── user.py             # User SQLModel
│   │   └── task.py             # Task SQLModel
│   ├── schemas/
│   │   ├── __init__.py
│   │   ├── user.py             # User Pydantic schemas (request/response)
│   │   └── task.py             # Task Pydantic schemas (request/response)
│   ├── api/
│   │   ├── __init__.py
│   │   ├── deps.py             # Dependency injection (JWT verification)
│   │   └── routes/
│   │       ├── __init__.py
│   │       ├── auth.py         # Authentication endpoints (if needed beyond Better Auth)
│   │       └── tasks.py        # Task CRUD endpoints
│   ├── middleware/
│   │   ├── __init__.py
│   │   └── jwt_auth.py         # JWT verification middleware
│   └── utils/
│       ├── __init__.py
│       └── security.py         # Password hashing, JWT utilities
├── tests/
│   ├── __init__.py
│   ├── test_auth.py            # Authentication flow tests
│   └── test_tasks.py           # Task CRUD tests
├── requirements.txt            # Python dependencies
├── .env.example                # Environment variables template
└── README.md                   # Backend setup instructions

frontend/
├── src/
│   ├── app/
│   │   ├── layout.tsx          # Root layout
│   │   ├── page.tsx            # Landing/home page
│   │   ├── (auth)/
│   │   │   ├── signin/
│   │   │   │   └── page.tsx    # Sign in page
│   │   │   └── signup/
│   │   │       └── page.tsx    # Sign up page
│   │   └── (protected)/
│   │       ├── dashboard/
│   │       │   └── page.tsx    # Task list dashboard
│   │       └── tasks/
│   │           └── [id]/
│   │               └── page.tsx # Task detail page
│   ├── components/
│   │   ├── ui/                 # Reusable UI components
│   │   ├── TaskList.tsx        # Task list component
│   │   ├── TaskItem.tsx        # Individual task component
│   │   ├── TaskForm.tsx        # Create/edit task form
│   │   └── AuthGuard.tsx       # Protected route wrapper
│   ├── lib/
│   │   ├── api.ts              # API client with JWT token injection
│   │   ├── auth.ts             # Better Auth configuration
│   │   └── types.ts            # TypeScript types
│   └── styles/
│       └── globals.css         # Global styles (TailwindCSS)
├── public/                     # Static assets
├── package.json                # Node dependencies
├── tsconfig.json               # TypeScript configuration
├── tailwind.config.js          # TailwindCSS configuration
├── next.config.js              # Next.js configuration
├── .env.local.example          # Environment variables template
└── README.md                   # Frontend setup instructions

.env.example                    # Root environment variables template
README.md                       # Project overview and setup
```

**Structure Decision**: Web application structure (Option 2) selected because the feature requires separate frontend (Next.js) and backend (FastAPI) services. This separation enables:
- Independent deployment and scaling
- Clear separation of concerns (UI vs API logic)
- Technology-specific optimization (Node.js for frontend, Python for backend)
- CORS-based communication between services
- Agent specialization (nextjs-ui-builder for frontend, fastapi-backend-dev for backend)

## Complexity Tracking

> **No violations identified** - All constitutional principles are satisfied without exceptions.

## Phase 0: Research & Technology Validation

**Status**: To be generated in research.md

**Research Areas**:
1. Better Auth JWT configuration for Next.js 16+ App Router
2. FastAPI JWT verification middleware patterns
3. SQLModel with Neon PostgreSQL best practices
4. CORS configuration for Next.js + FastAPI
5. Environment variable management across frontend and backend

## Phase 1: Design Artifacts

**Status**: To be generated

**Artifacts to Create**:
1. **data-model.md**: User and Task entity definitions with relationships
2. **contracts/auth-api.yaml**: Authentication endpoint specifications
3. **contracts/tasks-api.yaml**: Task CRUD endpoint specifications
4. **quickstart.md**: Local development setup instructions

## Agent Assignment Strategy

**Phase-by-Phase Agent Coordination**:

1. **Database Foundation** (`neon-db-manager`):
   - Design User and Task schemas
   - Configure Neon PostgreSQL connection
   - Create SQLModel definitions
   - Set up database migrations

2. **Backend API** (`fastapi-backend-dev`):
   - Implement FastAPI application structure
   - Create task CRUD endpoints
   - Implement request/response validation
   - Configure CORS for frontend communication

3. **Authentication Layer** (`auth-security-handler`):
   - Configure Better Auth on frontend
   - Implement JWT verification middleware on backend
   - Set up JWT token issuance and validation
   - Implement password hashing and security utilities

4. **Frontend UI** (`nextjs-ui-builder`):
   - Build authentication pages (signin, signup)
   - Create task management UI (list, detail, create, edit)
   - Implement protected routing
   - Configure API client with JWT token injection

## Architectural Decisions Requiring ADRs

1. **JWT-Based Authentication Architecture**: Decision to use Better Auth with JWT tokens for stateless authentication across frontend and backend
2. **Separate Frontend/Backend Services**: Decision to deploy Next.js and FastAPI as independent services with REST API communication
3. **Database Schema Design**: User and Task entity relationships with user_id foreign key for data isolation
4. **API Endpoint Structure**: RESTful URL design with user_id in path for explicit ownership verification

## Risk Analysis

**Top Risks**:

1. **JWT Secret Synchronization**: Frontend (Better Auth) and backend (FastAPI) must share the same JWT secret
   - **Mitigation**: Use environment variables with clear documentation in quickstart.md
   - **Validation**: Test token verification in both directions during implementation

2. **CORS Configuration**: Frontend and backend on different origins require proper CORS setup
   - **Mitigation**: Configure FastAPI CORS middleware with explicit frontend origin
   - **Validation**: Test API calls from frontend during integration phase

3. **User Data Isolation**: Risk of query bugs exposing cross-user data
   - **Mitigation**: Enforce user_id filtering at database query level, not application logic
   - **Validation**: Test with multiple users attempting to access each other's tasks

## Next Steps

1. Generate `research.md` (Phase 0)
2. Generate `data-model.md` (Phase 1)
3. Generate `contracts/` API specifications (Phase 1)
4. Generate `quickstart.md` (Phase 1)
5. Update agent context with technology stack
6. Run `/sp.tasks` to break down into implementation tasks
